Controlling Access in Virtual Infrastructures
=============================================

Like any other IT system, openstack based cloud deployments are vulnerable to security threats. The openstack security guideline identifies four elements in the security domain - users, applications, servers or networks that share common trust requirements and expectations within a system. Of which we can roughly categorize applications, servers and networks as virtual infrastructure. In this section we focus on how access control can be done to such virtual infrastructure so that only authenticated and authorized users or services get access.

The underlying virtualization technology with in openstack provides enterprise-level capabilities in any openstack deployment. As capabilities like scalability, efficiency, uptime and the likes are controlled by it; important virtual infrastructures within openstack are also managed by the virtualization technology in use. 

The openstack security guideline and the Hypervisor Support matrix (https://wiki.openstack.org/wiki/HypervisorSupportMatrix) present detailed information about the different supported virtualization tools and their access control capabilities. However such capabilities vary from one version of the tool to another or one openstack release to another; so we focus more on general issues related to the security of virtual infrastructures. NIST has done an important work with respect to identifying major security issues when it comes to virtual infrastructures and suggested solutions in its Guide to Security for Full Virtualization Technologies document (http://csrc.nist.gov/publications/nistpubs/800-125/SP800-125-final.pdf). We have adopted the suggestions in the Guide and included them in the sections below, as the recommendations can be applied in cloud infrastructure.

In virtualization the hypervisor has main responsibility to secure the entire virtualization environment. Hypervisors have to be secure enough to block attacks directed to the hypervisor itself, the host and/or the guest OS. Attackers usually try to break out of a guest OS so that they can gain access to the hypervisor, other guest OSs, or the underlying host. Compromise of the hypervisor can give control of all of its guest Oss to the attacker which makes it a primary target. Guest OS isolation can be one preventive mechanism but Guest OSs are often not completely isolated from each other and from the host OS because that would affect some necessary functionalities. For example, many hosted virtualization solutions provide mechanisms called guest tools through which a guest OS can access files, directories, the copy/paste buffer, and other resources on the host OS or another guest OS.

These communication mechanisms can inadvertently serve as an attack vector, such as transmitting malware or permitting an attacker to gain access to particular resources.  However, bare metal virtualization software does not offer such sharing capabilities and this makes them a preferred choice when considering such requirements. In addition to guest-OS isolation, hypervisors mitigate attacks through the guest OS, by guest OS monitoring and image and snapshot management mechanisms. We discuss these mechanisms  briefly in the following sub-sections. 

Guest OS Isolation
******************

In virtualization the hypervisor is responsible for managing guest OS access to hardware (e.g., CPU, memory, storage). The hypervisor partitions these resources so that each guest OS can access its own resources but cannot encroach on the other guest OSs’ resources or any resources not allocated for virtualization use. This prevents unauthorized access to resources and also helps prevent one guest OS from injecting malware into another, such as infecting a guest OS’s files or placing malware code into another guest OS’s memory. Separately, partitioning can also reduce the threat of denial of service conditions caused by excess resource consumption in other guest OSs on the same hypervisor.

Another motivation for isolating guest OSs from each other and the underlying hypervisor and host OS is the mitigation of side-channel attacks. These attacks exploit the physical properties of hardware to reveal information about usage patterns for memory access, CPU use, and other resources. A common goal of these attacks is to reveal cryptographic keys. These attacks are considered difficult, usually requiring direct physical access to the host.


Guest OS Monitoring
*******************

The hypervisor is fully aware of the current state of each guest OS it controls. As such, the hypervisor may have the ability to monitor each guest OS as it is running, which is known as introspection. Introspection can provide full auditing capabilities that may otherwise be unavailable. Monitoring capabilities provided through introspection can include network traffic, memory, processes, and other elements of a guest OS. For many virtualization products, the hypervisor can incorporate additional security controls or interface with external security controls and provide information to them that was gathered through introspection. Examples include firewalling, intrusion detection, and access control. Many products also allow the security policy being enforced through hypervisor-based security controls to be moved as a guest OS is migrated from one physical host to another. Network traffic monitoring is particularly important when networking is being performed between two guest OSs on the host or between a guest OS and the host OS. Under typical network configurations, this traffic does not pass through network-based security controls, so host-based security controls should be used to monitor the traffic instead.

Image and Snapshot Management
*****************************

Image and snapshot management is an often neglected part of cloud environments and big organizations need some standard routines on this as the number of images and snapshots can go very high and problems that arise due to unpatched or vulnerable images can increase the risk of security attacks on organizations' IT infrastructure. The NIST Guide to Security for Full Virtualization Technologies suggests the recommendations shown below. Creating guest machine images and snapshots does not affect the vulnerabilities within them, such as the vulnerabilities in the guest OSs, services, and applications. However, images and snapshots do affect security in several ways, some positive and some negative, and they also affect IT operations.

Note that one of the biggest security issues with images and snapshots is that they contain sensitive data (such as passwords, personal data, and so on) just like a physical hard drive. Because it is easier to move around an image or snapshot than a hard drive, it is more important to think about the security of the data in that image or snapshot. Snapshots can be more risky than images because snapshots contain the contents of RAM memory at the time that the snapshot was taken, and this might include sensitive information that was not even stored on the drive itself.

An operating system and applications can be installed, configured, secured, and tested in a single image and that image then distributed to many hosts. This can save considerable time, providing additional time for the contents of the image to be secured more effectively, and also improve the consistency and strength of security across hosts. However, because images can be distributed and stored easily, they need to be carefully protected against unauthorized access, modification, and replacement. Some organizations need to have a small number of known-good images of guest OSs that differ, for example, based on the application software that is installed.

As the use of server and desktop virtualization as well as cloud computing infrastructure grows within an organization, the management of images can become a significant challenge. Some virtualization products offer management solutions that can examine stored images and update them as needed, such as applying patches and making security configuration changes, but other products offer no way of applying updates other than loading each image. For these products, the longer an image is stored without running it, the more vulnerabilities it is likely to contain when it is loaded again. It may be necessary to track all images and ensure that each non-archival image is periodically updated. 

Tracking images may also be a significant problem, particularly if users and administrators are able to create their own images. These images may also not be secured properly, especially if they are not based on a security baseline (e.g., the one provided by a different pre-secured image). This could increase the risk of compromise.

Another potential problem with increasing the use of virtualization in particular is the proliferation of images, also known as sprawl. It is easy to create a new image — it can often be done in just a few minutes, albeit without any consideration of security—so unnecessary images may be created and run. Each additional image running is another potential point of compromise for an attacker. Also, each additional image is another image that has to have its security maintained. Therefore, organizations should minimize the creation, storage, and use of unnecessary images. Organizations should consider implementing formal image management processes that govern image creation, security, distribution, storage, use, retirement, and destruction, particularly for server virtualization. Similar consideration shall be given to snapshot management. In some cases, organizations have policies to not allow storage of snapshots because of the risk of malware from infected systems being stored in snapshots and later reloaded.

Image management can provide significant security and operational benefits to an organization. For example, if the contents of an image become compromised, corrupted, or otherwise damaged, the image can quickly be replaced with a known good image. Also, snapshots can serve as backups; permitting the rapid recovery of information added to the guest OS since the original image was deployed. One of the drawbacks associated with this type of backup is that incremental or differential backups of the system may not be feasible unless those backups are supported by the hypervisor. If a modification is made to the guest OS after a snapshot has been captured, the original snapshot will not include the modification. So, a new snapshot will need to be applied. Because of this, snapshot management needs to be considered as part of image management.

Image files can be monitored to detect unauthorized changes to the image files; this can be done by calculating cryptographic checksums for each file as it is stored, then recalculating these checksums periodically and investigating the source of any discrepancies. Image files can also be scanned to detect rootkits and other malware that, when running, conceal themselves from security software present within the guest OS.

Hypervisor Security
*******************
Hypervisors are responsible for various tasks within a virtualized environment and they can become a single point of failure during compromise. Due consideration shall be given to the security of hypervisors and  we extract the following important recommendations from the NIST document on how to secure hypervisors:

*	Most hypervisor software currently only use passwords for access control; this may be too weak for some organizations’ security policies and may require the use of compensating controls, such as a separate authentication system used for restricting access to the host on which the virtualization management system is installed.
*	Hypervisors can be managed in different ways, with some hypervisors allowing management through multiple methods. It is important to secure each hypervisor management interface, both locally and remotely accessible. The capability for remote administration can usually be enabled or disabled in the virtualization management system. If remote administration is enabled in a hypervisor, access to all remote administration interfaces should be restricted by a firewall. Also, hypervisor management communications should be protected. One option is to have a dedicated management network that is separate from all other networks and that can only be accessed by authorized administrators. Management communications carried on untrusted networks must be encrypted using FIPS-approved methods, provided by either the virtualization solution or a third-party solution, such as a virtual private network (VPN) that encapsulates the management traffic.
*	Because of the hypervisor’s level of access to and control over the guest OSs, limiting access to the hypervisor is critical to the security of the entire system. The access options vary based on hypervisor type. Most bare metal hypervisors have access controls to the system. Typically, the access method is just username and password, but some bare metal hypervisors offer additional controls such as hardware token-based authentication to grant access to the hypervisor’s management interface. On some systems, there are different levels of authorization, such as allowing some users to view logs but not be able to change any settings or interact directly with the guest OSs. These view-only user accounts allow auditors and others to have sufficient access to meet their needs without reducing overall security.
*	In contrast to bare metal solutions, hosted virtualization products rarely have hypervisor access controls: anyone who can launch an application on the host OS can run the hypervisor. The only access control is whether or not someone can log into the host OS. Because of this wide disparity in security, organizations should have security policies about which guest OSs can be run from bare metal hypervisors and which can be run from hosted virtualization hypervisors. Further, organizations running bare metal hypervisors should have policies specifying who can and cannot access various features of the hypervisor.
*	Install all updates to the hypervisor as they are released by the vendor. Most hypervisors have features that will check for updates automatically and install the updates when found. Centralized patch management solutions can also be used to administer updates.
*	Restrict administrative access to the management interfaces of the hypervisor. Protect all management communication channels using a dedicated management network or the management network communications is authenticated and encrypted using FIPS 140-2 validated cryptographic modules.
*	Synchronize the virtualized infrastructure to a trusted authoritative time server.
*	Disconnect unused physical hardware from the host system. For example, a removable disk drive might be occasionally used for backups, but it should be disconnected when not actively being used for backup or restores. Disconnect unused NICs from any network.
*	Disable all hypervisor services such as clipboard- or file-sharing between the guest OS and the host OS unless they are needed. Each of these services can provide a possible attack vector. File sharing can also be an attack vector on systems where more than one guest OS share the same folder with the host OS.
*	Consider using introspection capabilities to monitor the security of each guest OS. If a guest OS is compromised, its security controls may be disabled or reconfigured so as to suppress any signs of compromise. Having security services in the hypervisor permits security monitoring even when the guest OS is compromised.
*	Consider using introspection capabilities to monitor the security of activity occurring between guest OSs. This is particularly important for communications that in a non-virtualized environment were carried over networks and monitored by network security controls (such as network firewalls, security appliances, and network IDPS sensors).
*	Carefully monitor the hypervisor itself for signs of compromise. This includes using self-integrity monitoring capabilities that hypervisors may provide, as well as monitoring and analyzing hypervisor logs on an ongoing basis.
*	It is also important to provide physical access controls for the hardware on which the virtualization system runs. For example, hosted hypervisors are typically controlled by management software that can be used by anyone with access to the keyboard and mouse. Even bare metal hypervisors require physical security: someone who can reboot the host computer that the hypervisor is running on could alter some of the security settings for the hypervisor. It is also important to secure the external resources that the hypervisor uses, particularly data on hard drives and other storage devices.
*	There are additional recommendations for hosted virtualization solutions for server virtualization. Hosted virtualization exposes the system to more threats because of the presence of a host OS. To increase the security of the host OS, minimize the number of applications other than the hypervisor that are ever run on the system. All unneeded applications should be removed. Those that remain should be restricted as much as possible to prevent malware from being inadvertently installed on the system. For example, a web browser is often used to download updates to the hypervisor, and also to read instructions and bulletins about the hypervisor. If the computer is intended to be exclusively used to run the hosted hypervisor, the web browser should have as many settings as possible adjusted to their highest security level.
*	Because hosted virtualization systems are run under host OSs, the security of every guest OS relies on the security of the host OS. This means that there should be tight access controls to the host OS to prevent someone from gaining access through the host OS to the virtualization system and possibly changing its settings or modifying the guest OSs.
*	There have been some concerns in the security community about designing hypervisors so that they cannot be detected by attackers. The motivation for this was to provide an additional layer of security that is invisible to the attacker, thus preventing successful attacks against the hypervisor and the host OS underneath it. One of the basic principles of security design, however suggests that the design of a security solution shall not depend on its secrecy. In addition, hypervisors have various characteristics that permit attackers to detect their presence. Detection techniques include checking for hypervisor artifacts in processes, file system, registry, and memory; checking for hypervisor-specific processor instructions or capabilities; and checking for hypervisor-specific virtual hardware devices. These detection techniques are hypervisor implementation-dependent. Although hypervisor detection can be deterred by a vendor modifying the hypervisor’s implementation or hiding its identifiable software artifacts, it is not possible to completely hide all characteristics. When planning their virtualization security, organizations shall not assume that attackers will not be able to detect the presence of a hypervisor or the product type and version.


Host Security 
*************

Without virtualization, services are usually deployed on dedicated host for isolation. In virtualization, a single host can be used multiple VMs each running an OS and one or more services. This is one of the advantages of virtualization but it at the same time makes the security of the host more critical as a compromise can affect multiple services. The increase in the number of services running on a single host increases the attack vector and a compromise on any of the running services can open a security hole on the other services sharing the same host. A holistic view of the system operations as well as security solutions is required for any of our actions on the host as well as the VMs and services running on it. Apart from that security solutions and policies that apply for any host in the organization’s environment can be applied on hosts involved in a virtualized environment. 

Guest OS Security 
*****************

Virtualization can be taken as an additional layer of security when it comes to guest OS security. In a non-virtualized environment, a compromise in the underlying OS can affect the hardware resources in the host machine. However, in virtualization access to hardware resources by the guest OS is mediated through hypervisors. Compromise in the guest OS cannot directly lead to misuse or compromise of the underlying hardware in the host machine. But as mentioned in section 2.2 above Guest OSs are often not completely isolated from each other and from the host OS. Which makes a compromise on the guest OS as a means to gain access to other guest OSs, the host OS and the hypervisor. We suggest the following recommendations that are extracted from the NIST Guide to Security for Full Virtualization Technologies -

*	Organizations that have security policies that cover network shared storage should apply those policies to shared disks in virtualization systems.
*	Follow the recommended practices for managing the physical OS, e.g., time synchronization, log management, authentication, remote access, etc.
*	Install all updates to the guest OS promptly. All modern OSs have features that will automatically check for updates and install them.
*	Back up the virtual drives used by the guest OS on a regular basis, using the same policy for backups as is used for non-virtualized computers in the organization.
*	In each guest OS, disconnect unused virtual hardware. This is particularly important for virtual drives (usually virtual CDs and floppy drives), but is also important for virtual network adapters other than the primary network interface and serial and/or parallel ports.
*	Use separate authentication solutions for each guest OS unless there is a particular reason for two guest OSs to share credentials.
*	Ensure that virtual devices for the guest OS are associated only with the appropriate physical devices on the host system, such as the mappings between virtual and physical NICs.

If a guest OS on a hosted virtualization system is compromised, that guest OS can potentially infect other systems on the same hypervisor. The most likely way this can happen is that both systems are sharing disks or clipboards. If such sharing is turned on in two or more guest OSs, and one guest OS is compromised, the administrator of the virtualization system needs to decide how to deal with the potential compromise of other guest OSs. Two strategies for dealing with this situation are:

*	Assume that all guest OSs on the same hardware have been compromised. Revert each guest OS to a known-good image that was saved before the compromise.
*	Investigate each guest OS for compromise, just as one would during normal scanning for malware. If malware is found, follow the organization’s normal security policy.

The first method assumes that guest OSs are different than “regular” systems, while the second assumes that the organization’s current security policy is sufficient and should be applied to all systems in the same manner.

Secure Virtualization Planning and Deployment
*********************************************

A critical aspect of deploying a secure virtualization solution is careful planning prior to installation, configuration, and deployment. This helps ensure that the virtual 
environment is as secure as possible and in compliance with all relevant organizational policies. Based on the NIST SP 800-64 standard on Security Considerations in the Information 
System Development Life Cycle we suggest the following 5 phases for a secure virtualization environment planning and deployment.  Please refer the document for a more detailed 
description of each of these phases.

**Phase 1: Initiation -** This phase includes the tasks that an organization should perform before it starts to design a virtualization solution. These include identifying needs for virtualization, providing an overall vision for how virtualization solutions would support the mission of the organization, creating a high-level strategy for implementing virtualization solutions, developing virtualization policy, identifying platforms and applications that can be virtualized, and specifying business and functional requirements for the solution.

**Phase 2: Planning and Design -** In this phase, personnel specify the technical characteristics of the virtualization solution and related components. These include the authentication methods and the cryptographic mechanisms used to protect communications. At the end of this phase, solution components are procured.

**Phase 3: Implementation -** In this phase, equipment is configured to meet operational and security requirements, installed and tested as a prototype, and then activated on a production network. Implementation includes altering the configuration of other security controls and technologies, such as security event logging, network management, and authentication server integration.

**Phase 4: Operations and Maintenance -** This phase includes security-related tasks that an organization should perform on an ongoing basis once the virtualization solution is operational, including log review, attack detection, and incident response.

**Phase 5: Disposition -** This phase encompasses tasks that occur when a virtualization solution is being retired, including preserving information to meet legal requirements, sanitizing media, and disposing of equipment properly.
